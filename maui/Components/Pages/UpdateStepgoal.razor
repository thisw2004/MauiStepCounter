@page "/UpdateStepgoal"
@using maui.Components.Models
@inject StepgoalViewModel viewModel
@inject NavigationManager Navigation

<h1>Update Today's Step Goal</h1>

@if (!viewModel.IsSuccessful)
{
    <p>Error fetching step goal. Please try again later.</p>
}
else if (!viewModel.IsSuccessful && viewModel.ErrorMessage != "")
{
    <p>@viewModel.ErrorMessage</p>
}
else if (!viewModel.IsSuccessful)
{
    <p>No step goal found for today.</p>
}
else
{
    // Cast the viewmodel to access the private property (if type is known)
    var castedViewModel = (StepgoalViewModel)viewModel;

    <form @submit="@(() => { 
              var goal = castedViewModel.AllStepgoals.FirstOrDefault(sg => sg.Date.Date == DateTime.Today.Date)?.Goal ?? 0;
              return viewModel.UpdateStepgoal(new StepgoalModel { Goal = goal }); 
          })"
>        <p>Current goal(s) for today:</p>
        @foreach (var goal in castedViewModel.AllStepgoals.Where(sg => sg.Date.Date == DateTime.Today.Date))
        {
            <p>@goal.Goal</p>
        }
        <label for="goal">New Goal :</label>
        <input type="number" id="goal" @bind="viewModel.Goal" placeholder="Enter new goal"/>

        <br/>
        <button type="submit">Update</button>
    </form>
}
@**@